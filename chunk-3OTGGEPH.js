import{a as b}from"./chunk-GI5MFPPU.js";import{a as z,b as $}from"./chunk-GFF2Z7V3.js";import{a as J}from"./chunk-SNQC5Y52.js";import{$a as g,Da as c,Ea as u,Ec as U,Ja as F,Jc as V,M,Ma as k,N as P,Na as h,Sc as A,Ub as N,ab as _,ca as l,cb as D,f as C,ga as f,ka as B,m as I,na as T,sc as j,ua as v,va as S,wa as y,xa as O,ya as w}from"./chunk-5Q5JURXL.js";function L(a,d){if(a&1){let s=F();c(0,"button",16),k("click",function(n){M(s);let o=h().$implicit,t=h(2).$implicit;return h().handleButtonClick(o,t),P(n.stopPropagation())}),c(1,"span",4),g(2),u()()}if(a&2){let s=h().$implicit;l(2),_(s==null?null:s.icon)}}function R(a,d){if(a&1&&v(0,L,3,1,"button",15),a&2){let s=d.$implicit;S(s!=null&&s.icon?0:-1)}}function q(a,d){if(a&1&&(c(0,"div",14),O(1,R,1,1,null,null,y),u()),a&2){let s=h(2);l(),w(s.config.buttons.slice(1))}}function G(a,d){if(a&1&&(c(0,"div",6)(1,"div",7)(2,"h3",8),g(3),u(),c(4,"p",9),g(5),c(6,"span",10),g(7),u()()(),c(8,"div",11)(9,"p",12),g(10),u(),c(11,"p",13),g(12),u()(),v(13,q,3,0,"div",14),u()),a&2){let s=d.$implicit,e=h();l(3),_(s.note),l(2),D(" ",s.isDeposit?"+":"-","",s.amount," "),l(2),_(e.selectedBudget==null?null:e.selectedBudget.currency),l(3),_(s.unitName),l(2),_(s.budgetName),l(),S(e.config.buttons.length?13:-1)}}var E=(()=>{let d=class d extends j{allowUrl(){return!1}constructor(e,n,o,t,i,p){super(b,i,t,e,"Budgettransaction"),this._budgettransactionService=e,this._unitService=n,this._budgetService=o,this._router=p,this.configType="local",this.columns=["isDeposit","amount","note","budgetName","unitName"],this.config=this.getConfig(),this.budget=this._router.url.replace("/transactions/",""),this.allUnits=[],this.selectedBudget=null,this.config.buttons.unshift({icon:"add",click:()=>this.createTransaction()}),this.config.buttons.push({icon:"edit",click:r=>this.editTransaction(r)}),this.config.buttons.push({icon:"delete",click:r=>this.deleteTransaction(r)})}ngOnInit(){return C(this,null,function*(){let e=localStorage.getItem("selectedBudgetId");if(e){let n=yield this._budgetService.getAllBudgets();this.selectedBudget=n.find(o=>o._id===e)||null}yield this.loadUnits(),yield this.loadTransactions(),yield this.loadBudgets(),this.markSelectedBudget(),this.setDocuments()})}loadTransactions(){return C(this,null,function*(){let e=yield I(this._budgettransactionService.getTransactionsByBudget(this.budget));e.forEach(n=>{!n.unitId&&n.units?.length&&(n.unitId=n.units[0].unit),n.isDeposit=!!n.isDeposit;let o=this.allUnits.find(i=>i._id===n.unitId);n.unitName=o?o.name:n.unitId;let t=this._budgetService.budgets?.find(i=>i._id===n.budget);n.budgetName=t?t.name:n.budget}),this._budgettransactionService.budgettransactions=e,this.documents=e,this.markSelectedUnits()})}preCreate(e){e.budget=this.budget;let n=this.form?.components?.find(i=>i.key==="unitId"&&i.name==="Select");if(!n)throw new Error("Category select component not found");if(!n.fields.find(i=>i.name==="Items"))throw new Error("Category items field not found");e.units=[{unit:e.unitId,amount:e.amount}];let t=this.form?.components?.find(i=>i.key==="isDeposit"&&i.name==="Boolean")?.fields.find(i=>i.name==="Value");e.isDeposit=!!t?.value}loadUnits(){return C(this,null,function*(){return new Promise(e=>{this._unitService.getUnitsByBudget(this.budget).subscribe(n=>{this.allUnits=n;let o=b.components[3].fields[0].value;o.splice(0,o.length),o.push(...n),e()})})})}loadBudgets(){return C(this,null,function*(){let e=b.components.find(t=>t.key==="budget"&&t.name==="Select");if(!e)return;let n=e.fields.find(t=>t.name==="Items");if(!n)return;let o=n.value;o.splice(0,o.length);try{let t=yield this._budgetService.getAllBudgets();o.push(...t),this._budgetService.budgets=t,console.log("Budgets loaded:",t),this.form?.updateFields?.([e])}catch(t){console.error("Error loading budgets:",t)}})}markSelectedUnits(){let e=this.form?.components?.find(t=>t.key==="unitId"&&t.name==="Select");if(!e)return;let n=e.fields.find(t=>t.name==="Items");if(!n)return;let o=n.value;this._budgettransactionService.budgettransactions.forEach(t=>{let i=o.find(p=>p.value===t.unitId);i&&(i.selected=!0)}),n.value=o,this.form?.updateFields?.([e])}markSelectedBudget(){let e=this.form?.components?.find(t=>t.key==="budget"&&t.name==="Select");if(!e)return;let n=e.fields.find(t=>t.name==="Items");if(!n)return;let o=this._budgetService.budgets?.find(t=>t._id===this.budget);o&&(n.value=[{name:o.name,value:o._id,selected:!0}]),this.form?.updateFields?.([e])}handleButtonClick(e,n){e.click&&n!==void 0?e.click(n):e.click&&e.click()}createTransaction(){let e=JSON.parse(JSON.stringify(b));this.formService.modal(e,[{label:"Create",click:(n,o)=>{let t=n;if(t.budget=this.budget,!t.unitId||!t.amount||t.amount<=0){alert("Please select a category and enter an amount greater than 0.");return}t.units=[{unit:t.unitId,amount:t.amount}],t.isDeposit=!!t.isDeposit;let i=this.allUnits.find(r=>r._id===t.unitId);t.unitName=i?i.name:t.unitId;let p=this._budgetService.budgets?.find(r=>r._id===t.budget);t.budgetName=p?p.name:t.budget,this.service.create(t).subscribe({next:r=>{this._budgettransactionService.budgettransactions=[...this._budgettransactionService.budgettransactions,r],this.documents=[...this.documents,r],this.setDocuments(),this.markSelectedUnits(),o()},error:r=>console.error("Error creating transaction:",r)})}}])}editTransaction(e){let n=JSON.parse(JSON.stringify(b));this.formService.modal(n,[{label:"Edit",click:(o,t)=>{let i=o;if(i._id=e._id,i.budget=this.budget,!i.unitId||!i.amount||i.amount<=0){alert("Please select a Category and enter an amount greater than 0.");return}i.units=[{unit:i.unitId,amount:i.amount}],i.isDeposit=!!i.isDeposit;let p=this.allUnits.find(m=>m._id===i.unitId);i.unitName=p?p.name:i.unitId;let r=this._budgetService.budgets?.find(m=>m._id===i.budget);i.budgetName=r?r.name:i.budget,this.service.update(i).subscribe({next:m=>{this._budgettransactionService.budgettransactions=this._budgettransactionService.budgettransactions.map(x=>x._id===m._id?m:x),this.documents=this.documents.map(x=>x._id===m._id?m:x),this.setDocuments(),this.markSelectedUnits(),t()},error:m=>console.error("Error editing transaction:",m)})}}],e)}deleteTransaction(e){e._id&&confirm(`Delete transaction "${e.note}"?`)&&this.service.delete(e).subscribe(()=>{this.documents=this.documents.filter(n=>n._id!==e._id),this.setDocuments()})}};d.\u0275fac=function(n){return new(n||d)(f($),f(J),f(z),f(U),f(V),f(N))},d.\u0275cmp=B({type:d,selectors:[["ng-component"]],features:[T],decls:10,vars:1,consts:[["id","wrapper",1,"wrapper"],[1,"transactions-header"],[1,"name-page"],[1,"create-btn",3,"click"],[1,"material-icons"],[1,"transactions-cards"],[1,"transaction-card","clickable-card"],[1,"transaction-left"],[1,"transaction-note"],[1,"transaction-amount"],[1,"currency"],[1,"transaction-right"],[1,"transaction-unit"],[1,"transaction-budget"],[1,"transaction-actions"],[1,"action-btn"],[1,"action-btn",3,"click"]],template:function(n,o){n&1&&(c(0,"div",0)(1,"div",1)(2,"p",2),g(3,"My transactions"),u(),c(4,"button",3),k("click",function(){return o.handleButtonClick(o.config.buttons[0])}),c(5,"span",4),g(6),u()()(),c(7,"div",5),O(8,G,14,7,"div",6,y),u()()),n&2&&(l(6),_(o.config.buttons[0]==null?null:o.config.buttons[0].icon),l(2),w(o.documents))},dependencies:[A],styles:[".transactions-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-right:15px}.transactions-header[_ngcontent-%COMP%]   .create-btn[_ngcontent-%COMP%]{background-color:#1e8de2;color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:16px;cursor:pointer;display:flex;align-items:center;gap:5px}.transactions-header[_ngcontent-%COMP%]   .create-btn[_ngcontent-%COMP%]   span.material-icons[_ngcontent-%COMP%]{color:#fff;background:none;box-shadow:none}.transactions-header[_ngcontent-%COMP%]   .name-page[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin-left:20px;color:#efe8e8;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:400px;display:block}.transactions-cards[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px;margin-top:20px;padding-bottom:120px}.transaction-card[_ngcontent-%COMP%]{background:#373535;border-radius:8px;padding:15px 20px;min-height:150px;box-shadow:0 2px 5px #14131380;transition:transform .2s ease-in-out;cursor:pointer;position:relative;display:flex;justify-content:space-between;align-items:flex-start}.transaction-card[_ngcontent-%COMP%]   .transaction-left[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px;max-width:70%}.transaction-card[_ngcontent-%COMP%]   .transaction-left[_ngcontent-%COMP%]   .transaction-note[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#fff;margin:0 0 5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%;display:block}.transaction-card[_ngcontent-%COMP%]   .transaction-left[_ngcontent-%COMP%]   .transaction-amount[_ngcontent-%COMP%]{font-size:16px;color:#fff;margin:0 0 35px}.transaction-card[_ngcontent-%COMP%]   .transaction-right[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:3px;max-width:30%;position:absolute;top:50px;right:20px}.transaction-card[_ngcontent-%COMP%]   .transaction-right[_ngcontent-%COMP%]   .transaction-unit[_ngcontent-%COMP%], .transaction-card[_ngcontent-%COMP%]   .transaction-right[_ngcontent-%COMP%]   .transaction-budget[_ngcontent-%COMP%]{font-size:14px;color:#ccc;margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:120px;display:block}.transaction-card[_ngcontent-%COMP%]   .transaction-actions[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:10px;display:flex;gap:4px}.transaction-card[_ngcontent-%COMP%]   .transaction-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{background:transparent!important;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center}.transaction-card[_ngcontent-%COMP%]   .transaction-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]   span.material-icons[_ngcontent-%COMP%]{color:#fff;background:none!important;box-shadow:none!important}.currency[_ngcontent-%COMP%]{font-size:13px;margin-left:5px}"]});let a=d;return a})();var rt=[{path:"",component:E},{path:":id",component:E}];export{rt as transactionsRoutes};
