import{a as z,b as L}from"./chunk-GFF2Z7V3.js";import{a as V}from"./chunk-SNQC5Y52.js";import{$a as g,Da as s,Ea as m,Ec as N,Ja as F,Jc as U,M as w,Ma as C,N as P,Na as p,Sc as $,Ub as A,ab as x,bb as D,ca as l,f,ga as b,ka as T,m as h,na as I,sc as j,ua as B,va as M,wa as E,xa as O,ya as S}from"./chunk-5Q5JURXL.js";var v={formId:"budget",title:"Budget",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"Fill budget name..."},{name:"Label",value:"Title"}]},{name:"Number",key:"amount",focused:!0,fields:[{name:"Placeholder",value:"Fill budget amount..."},{name:"Label",value:"Amount"}]},{name:"Text",key:"currency",focused:!0,fields:[{name:"Placeholder",value:"Fill budget currency..."},{name:"Label",value:"Currency"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"Fill budget description..."},{name:"Label",value:"Description"}]}]};function R(c,d){if(c&1){let r=F();s(0,"button",14),C("click",function(t){w(r);let n=p().$implicit,u=p(2).$implicit;return p().handleButtonClick(n,u),P(t.stopPropagation())}),s(1,"span",4),g(2),m()()}if(c&2){let r=p().$implicit;l(2),x(r==null?null:r.icon)}}function q(c,d){if(c&1&&B(0,R,3,1,"button",13),c&2){let r=d.$implicit;M(r!=null&&r.icon?0:-1)}}function G(c,d){if(c&1&&(s(0,"div",12),O(1,q,1,1,null,null,E),m()),c&2){let r=p(2);l(),S(r.config.buttons.slice(1))}}function H(c,d){if(c&1){let r=F();s(0,"div",7),C("click",function(){let t=w(r).$implicit,n=p();return P(n.goToDashboard(t))}),s(1,"h3",8),g(2),m(),s(3,"p",9),g(4),s(5,"span",10),g(6),m()(),s(7,"p",11),g(8),m(),B(9,G,3,0,"div",12),m()}if(c&2){let r=d.$implicit,e=p();l(2),x(r.name),l(2),D(" ",r.amount," "),l(2),x(r.currency),l(2),x(r.description),l(),M(e.config.buttons.length?9:-1)}}var J=(()=>{let d=class d extends j{allowUrl(){return!1}constructor(e,t,n,u,a,i){super(v,n,t,e,"Budget"),this._budgetService=e,this._translate=t,this._form=n,this.router=u,this._budgettransactionService=a,this._budgetunitService=i,this.budgets=[],this.configType="local",this.columns=["name","description","amount","currency"],this.config=this.getConfig(),this.config.buttons.unshift({icon:"add",click:()=>this.createBudget()}),this.config.buttons.push({icon:"category",hrefFunc:o=>o._id?"/units/"+o._id:"/units"}),this.config.buttons.push({icon:"swap_horiz",click:o=>f(this,null,function*(){let _=yield h(this._budgetunitService.getUnitsByBudget(o._id));if(!_||_.length===0){alert("Please create a category before adding transactions");return}this.router.navigateByUrl("/transactions/"+o._id)})}),this.config.buttons.push({icon:"edit",click:o=>this.editBudget(o)}),this.config.buttons.push({icon:"delete",click:o=>this.deleteBudget(o)}),this.setDocuments()}handleButtonClick(e,t){if(e.hrefFunc){let n=t?e.hrefFunc(t):e.hrefFunc();this.router.navigateByUrl(n)}else e.click&&t!==void 0?e.click(t):e.click&&e.click()}setDocuments(){return f(this,null,function*(){this.documents=yield this._budgetService.getAllBudgets();let e={};for(let t of this.documents)e[t._id]=yield h(this._budgettransactionService.getTransactionsByBudget(t._id));for(let t of this.documents){t.initialAmount===void 0&&(t.initialAmount=Number(t.amount)||0);let u=e[t._id].reduce((a,i)=>{let o=i.isDeposit?1:-1;if(i.unitId)return a+o*i.amount;if(i.units&&Array.isArray(i.units)){let _=i.units.reduce((y,k)=>y+(k.amount||0),0);return a+o*_}return a+o*i.amount},0);t.amount=t.initialAmount+u}})}onTransactionCreated(e){return f(this,null,function*(){let t=this.documents.find(a=>a._id===e.budget);if(!t)return;t.initialAmount===void 0&&(t.initialAmount=Number(t.amount)||0);let u=(yield h(this._budgettransactionService.getTransactionsByBudget(t._id))).reduce((a,i)=>{let o=i.isDeposit?1:-1;if(i.unitId)return a+o*i.amount;if(i.units&&Array.isArray(i.units)){let _=i.units.reduce((y,k)=>y+(k.amount||0),0);return a+o*_}return a+o*i.amount},0);t.amount=t.initialAmount+u})}createBudget(){let e=JSON.parse(JSON.stringify(v));this._form.modal(e,[{label:"Create",click:(t,n)=>{let u=t;this._budgetService.create(u).subscribe({next:()=>f(this,null,function*(){yield this.setDocuments(),n()}),error:a=>console.error("Error creating budget:",a)})}}])}editBudget(e){let t=JSON.parse(JSON.stringify(v));this._form.modal(t,[{label:"Update",click:(n,u)=>f(this,null,function*(){let a=n;this._budgetService.update(a).subscribe({next:()=>f(this,null,function*(){yield this.setDocuments(),u()}),error:i=>console.error("Error updating budget:",i)})})}],e)}deleteBudget(e){e._id&&confirm(`Delete budget "${e.name}"?`)&&this._budgetService.delete(e).subscribe(()=>{this.documents=this.documents.filter(t=>t._id!==e._id)})}goToDashboard(e){localStorage.setItem("selectedBudgetId",e._id),localStorage.setItem("selectedBudgetName",e.name),this.router.navigate(["/dashboard"],{queryParams:{budget:e._id}}),window.dispatchEvent(new CustomEvent("budgetChanged",{detail:e}))}};d.\u0275fac=function(t){return new(t||d)(b(z),b(N),b(U),b(A),b(L),b(V))},d.\u0275cmp=T({type:d,selectors:[["ng-component"]],features:[I],decls:10,vars:1,consts:[["id","wrapper",1,"wrapper"],[1,"budgets-header"],[1,"name-page"],[1,"create-btn",3,"click"],[1,"material-icons"],[1,"budgets-cards"],[1,"budget-card","clickable-card"],[1,"budget-card","clickable-card",3,"click"],[1,"budget-name"],[1,"budget-amount"],[1,"currency"],[1,"budget-description"],[1,"budget-actions"],[1,"action-btn"],[1,"action-btn",3,"click"]],template:function(t,n){t&1&&(s(0,"div",0)(1,"div",1)(2,"p",2),g(3,"My budgets"),m(),s(4,"button",3),C("click",function(){return n.handleButtonClick(n.config.buttons[0])}),s(5,"span",4),g(6),m()()(),s(7,"div",5),O(8,H,10,5,"div",6,E),m()()),t&2&&(l(6),x(n.config.buttons[0]==null?null:n.config.buttons[0].icon),l(2),S(n.documents))},dependencies:[$],styles:[".budgets-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-right:15px}.budgets-header[_ngcontent-%COMP%]   .create-btn[_ngcontent-%COMP%]{background-color:#1e8de2;color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:16px;cursor:pointer;display:flex;align-items:center;gap:5px}.budgets-header[_ngcontent-%COMP%]   .create-btn[_ngcontent-%COMP%]   span.material-icons[_ngcontent-%COMP%]{color:#fff;background:none;box-shadow:none}.budgets-header[_ngcontent-%COMP%]   .name-page[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin-left:20px;color:#efe8e8;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:400px;display:block}.action-btn[_ngcontent-%COMP%]{background:transparent!important;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center}.action-btn[_ngcontent-%COMP%]   span.material-icons[_ngcontent-%COMP%]{color:#fff;background:none!important;box-shadow:none!important}.budgets-cards[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:15px;margin-top:20px;padding-bottom:120px}.budget-card[_ngcontent-%COMP%]{background:#373535;border-radius:8px;padding:15px 20px;box-shadow:0 2px 5px #14131380;transition:transform .2s ease-in-out;cursor:pointer;position:relative}.budget-card[_ngcontent-%COMP%]   .budget-name[_ngcontent-%COMP%]{font-size:18px;font-weight:700;margin:0 0 5px;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:400px;display:block}.budget-card[_ngcontent-%COMP%]   .budget-amount[_ngcontent-%COMP%]{font-size:16px;color:#fff}.budget-card[_ngcontent-%COMP%]   .currency[_ngcontent-%COMP%]{font-size:13px;margin-left:5px}.budget-card[_ngcontent-%COMP%]   .budget-description[_ngcontent-%COMP%]{font-size:11px}.budget-card[_ngcontent-%COMP%]   .budget-actions[_ngcontent-%COMP%]{position:absolute;bottom:10px;right:10px;display:flex;gap:4px}.budget-card[_ngcontent-%COMP%]   .budget-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]{background:transparent!important;color:#fff;border:none;border-radius:6px;padding:6px 10px;cursor:pointer;display:flex;align-items:center;justify-content:center}.budget-card[_ngcontent-%COMP%]   .budget-actions[_ngcontent-%COMP%]   .action-btn[_ngcontent-%COMP%]   span.material-icons[_ngcontent-%COMP%]{color:#fff;background:none!important;box-shadow:none!important}"]});let c=d;return c})();var dt=[{path:"",component:J}];export{dt as budgetsRoutes};
